AWSTemplateFormatVersion: "2010-09-09"

Description: Template generated by rain

Parameters:
  ProjectNameParameter:
    Type: String

Resources:
  LinebotProject:
    Type: AWS::CodeBuild::Project
    Properties:
      Artifacts:
        EncryptionDisabled: false 
        Location: !Sub "codebuild-${AWS::AccountId}-output-bucket"
        Name: !Sub ProjectNameParameter
        NamespaceType: NONE
        OverrideArtifactName: false
        Packaging: NONE
        Path: ""
        Type: S3
      BadgeEnabled: false 
      Cache: 
        Type: NO_CACHE
      ConcurrentBuildLimit: 1 
      EncryptionKey: !Sub "arn:aws:kms:${AWS::Region}:${AWS::AccountId}:alias/aws/s3"
      Environment:
        ComputeType: BUILD_GENERAL1_SMALL
        Image: aws/codebuild/amazonlinux2-x86_64-standard:3.0-21.04.23
        ImagePullCredentialsType: CODEBUILD 
        PrivilegedMode: false 
        Type: LINUX_CONTAINER
      LogsConfig: 
        CloudWatchLogs: 
          Status: ENABLED
        S3Logs: 
          EncryptionDisabled: false 
          Status: DISABLED
      Name: !Sub ${ProjectNameParameter}
      QueuedTimeoutInMinutes: 480
      ServiceRole: !Sub "arn:aws:iam::${AWS::AccountId}:role/service-role/codebuild-linebot_response-service-role"
      Source:
        GitCloneDepth: 1 
        GitSubmodulesConfig: 
          FetchSubmodules: false
        InsecureSsl: false 
        Location: !ImportValue LinebotRepositoryCloneUrlHttp
        Type: CODECOMMIT
      Tags:
        - Key: Owner
          Value: Masaya
      TimeoutInMinutes: 60
      
Outputs:
  LinebotProjectArn:
    Value: !GetAtt LinebotProject.Arn

